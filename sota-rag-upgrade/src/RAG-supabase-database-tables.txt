-- inside the SQL editor in Supabase dashboard
create extension if not exists vector;

create table public.record_manager_v2 (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  doc_id text not null,
  hash text not null,
  data_type text null default 'unstructured'::text,
  schema text null,
  document_title text null,
  graph_id text null,
  constraint record_manager_v2_pkey primary key (id)
) TABLESPACE pg_default;


create table public.tabular_document_rows (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  record_manager_id bigint null,
  row_data jsonb null,
  constraint tabular_document_rows_pkey primary key (id),
  constraint tabular_document_rows_record_manager_id_fkey foreign KEY (record_manager_id) references record_manager_v2 (id)
) TABLESPACE pg_default;


create table public.documents_v2 (
  id bigserial not null,
  content text null,
  metadata jsonb null,
  embedding vector(1536) null,
  fts tsvector GENERATED ALWAYS as (to_tsvector('english'::regconfig, content)) STORED null,
  constraint documents_v2_pkey primary key (id)
) TABLESPACE pg_default;

create index IF not exists documents_v2_embedding_idx on public.documents_v2 using hnsw (embedding vector_cosine_ops) TABLESPACE pg_default;

create index IF not exists documents_v2_fts_idx on public.documents_v2 using gin (fts) TABLESPACE pg_default;

create table public.metadata_fields (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  metadata_name text null,
  allowed_values text null,
  constraint metadata_fields_pkey primary key (id)
) TABLESPACE pg_default;

INSERT INTO "public"."metadata_fields" ("id", "created_at", "metadata_name", "allowed_values") VALUES ('1', '2025-07-22 12:58:35.05762+00', 'department', 'HR
Customer Support
Product
Sales
Marketing
Operations
Legal'), ('4', '2025-07-22 14:04:32.798523+00', 'document_date', 'Datetime format: YYYY-MM-DD');